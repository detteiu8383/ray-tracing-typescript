var A=Object.defineProperty;var H=(o,t,e)=>t in o?A(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var h=(o,t,e)=>(H(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class n{constructor(t,e,r){h(this,"e",[0,0,0]);this.e[0]=t,this.e[1]=e,this.e[2]=r}static add(t,e){return new n(t.e[0]+e.e[0],t.e[1]+e.e[1],t.e[2]+e.e[2])}static sub(t,e){return new n(t.e[0]-e.e[0],t.e[1]-e.e[1],t.e[2]-e.e[2])}static scale(t,e){return new n(t.e[0]*e,t.e[1]*e,t.e[2]*e)}static mul(t,e){return new n(t.e[0]*e.e[0],t.e[1]*e.e[1],t.e[2]*e.e[2])}static div(t,e){return new n(t.e[0]/e,t.e[1]/e,t.e[2]/e)}static pow(t,e){return new n(Math.pow(t.e[0],e),Math.pow(t.e[1],e),Math.pow(t.e[2],e))}static mag(t){return Math.sqrt(n.lengthSquared(t))}static lengthSquared(t){return t.e[0]*t.e[0]+t.e[1]*t.e[1]+t.e[2]*t.e[2]}static dot(t,e){return t.e[0]*e.e[0]+t.e[1]*e.e[1]+t.e[2]*e.e[2]}static cross(t,e){return new n(t.e[1]*e.e[2]-t.e[2]*e.e[1],t.e[2]*e.e[0]-t.e[0]*e.e[2],t.e[0]*e.e[1]-t.e[1]*e.e[0])}static normalize(t){const e=n.mag(t);return e===0?new n(0,0,0):n.div(t,e)}static randomUnitVector(){const t=Math.random()*2*Math.PI,e=1-2*Math.random(),r=Math.sqrt(1-e*e);return new n(r*Math.cos(t),r*Math.sin(t),e)}static randomInUnitDisk(){const t=Math.random()*2*Math.PI,e=Math.sqrt(Math.random());return new n(e*Math.cos(t),e*Math.sin(t),0)}static reflect(t,e){return n.sub(t,n.scale(e,2*n.dot(t,e)))}static refract(t,e,r){const s=n.dot(t,e),a=1-r*r*(1-s*s);return a>0?n.sub(n.scale(n.sub(t,n.scale(e,s)),r),n.scale(e,Math.sqrt(a))):new n(0,0,0)}}class b{constructor(t,e){this.origin=t,this.direction=e}at(t){return n.add(this.origin,n.scale(this.direction,t))}}class B{constructor(t,e,r,s,a,i,l){h(this,"origin");h(this,"lowerLeftCorner");h(this,"horizontal");h(this,"vertical");h(this,"u");h(this,"v");h(this,"w");h(this,"lensRadius");const m=s*Math.PI/180,w=Math.tan(m/2),d=2*w,u=a*d;this.w=n.normalize(n.sub(t,e)),this.u=n.normalize(n.cross(r,this.w)),this.v=n.cross(this.w,this.u),this.origin=t,this.horizontal=n.scale(this.u,u),this.vertical=n.scale(this.v,d),this.lowerLeftCorner=n.sub(n.sub(n.sub(this.origin,n.div(this.horizontal,2)),n.div(this.vertical,2)),n.scale(this.w,l)),this.lensRadius=i/2}getRay(t,e){const r=n.scale(n.randomInUnitDisk(),this.lensRadius),s=n.add(n.scale(this.u,r.e[0]),n.scale(this.v,r.e[1]));return new b(n.add(this.origin,s),n.sub(n.sub(n.add(n.add(this.lowerLeftCorner,n.scale(this.horizontal,t)),n.scale(this.vertical,e)),this.origin),s))}}class c extends n{constructor(t,e,r){super(t,e,r)}static legalize(t){return new c(Math.min(Math.max(t.e[0],0),1),Math.min(Math.max(t.e[1],0),1),Math.min(Math.max(t.e[2],0),1))}static writeColor(t,e,r,s){const a=c.div(t,s),i=c.pow(a,1/2.2),l=c.scale(c.legalize(i),255);r[e]=l.e[0],r[e+1]=l.e[1],r[e+2]=l.e[2],r[e+3]=255}}class E{constructor(t){h(this,"objects",[]);t&&(this.objects=t)}hit(t,e,r){let s=r,a=null;for(const i of this.objects){const l=i.hit(t,e,s);l&&(s=l.t,a=l)}return a}add(t){this.objects.push(t)}clear(){this.objects=[]}}class M{constructor(t,e,r){this.center=t,this.radius=e,this.material=r}hit(t,e,r){const s=n.sub(t.origin,this.center),a=n.lengthSquared(t.direction),i=n.dot(s,t.direction),l=n.lengthSquared(s)-this.radius*this.radius,m=i*i-a*l;if(m>0){const w=Math.sqrt(m),d=(-i-w)/a;if(d<r&&d>e){const p=t.at(d),g=n.div(n.sub(p,this.center),this.radius),f=this.radius>=0;return{point:p,normal:f?g:n.scale(g,-1),material:this.material,t:d,frontFace:f}}const u=(-i+w)/a;if(u<r&&u>e){const p=t.at(u),g=n.div(n.sub(p,this.center),this.radius),f=this.radius<0;return{point:p,normal:f?g:n.scale(g,-1),material:this.material,t:u,frontFace:f}}}return null}}class I{scatter(t,e){return{scattered:!1}}}class D extends I{constructor(t){super(),this.albedo=t}scatter(t,e){const r=n.add(e.normal,n.randomUnitVector()),s=new b(e.point,r);return{scattered:!0,scatteredRay:s,attenuation:this.albedo}}}class N extends I{constructor(t,e=0){super(),this.albedo=t,this.fuzz=e}scatter(t,e){const r=n.reflect(n.normalize(t.direction),e.normal),s=new b(e.point,n.add(r,n.scale(n.randomUnitVector(),this.fuzz))),a=this.albedo;return{scattered:n.dot(s.direction,e.normal)>0,scatteredRay:s,attenuation:a}}}class L extends I{constructor(t){super(),this.refractiveIndex=t}scatter(t,e){const r=new c(1,1,1),s=e.frontFace?1/this.refractiveIndex:this.refractiveIndex,a=n.normalize(t.direction),i=Math.min(-n.dot(a,e.normal),1),l=Math.sqrt(1-i*i);if(s*l>1||Math.random()<T(i,s)){const d=n.reflect(a,e.normal),u=new b(e.point,d);return{scattered:!0,scatteredRay:u,attenuation:r}}const m=n.refract(a,e.normal,s),w=new b(e.point,m);return{scattered:!0,scatteredRay:w,attenuation:r}}}const T=(o,t)=>{let e=(1-t)/(1+t);return e*=e,e+(1-e)*Math.pow(1-o,5)},C=(o,t,e)=>{if(e<=0)return new c(0,0,0);const r=t.hit(o,.001,1/0);if(r){const i=r.material.scatter(o,r);return i.scattered?c.mul(i.attenuation,C(i.scatteredRay,t,e-1)):new c(0,0,0)}const s=n.normalize(o.direction),a=.5*(s.e[1]+1);return c.add(c.scale(new c(1,1,1),1-a),c.scale(new c(.5,.7,1),a))},O=()=>{const o=1.7777777777777777,t=400,e=Math.floor(t/o),r=4,s=new Uint8Array(t*e*r),a=100,i=50,l=new E;l.add(new M(new n(0,0,-1),.5,new D(new c(.1,.2,.5)))),l.add(new M(new n(0,-100.5,-1),100,new D(new c(.8,.8,0)))),l.add(new M(new n(1,0,-1),.5,new N(new c(.8,.6,.2),.3))),l.add(new M(new n(-1,0,-1),.5,new L(1.5))),l.add(new M(new n(-1,0,-1),-.45,new L(1.5)));const m=new n(3,3,2),w=new n(0,0,-1),d=new n(0,1,0),u=n.mag(n.sub(m,w)),p=2,g=new B(m,w,d,90,o,p,u);for(let x=e-1;x>=0;x--)for(let z=0;z<t;z++){let R=new c(0,0,0);for(let q=0;q<a;q++){const S=(z+Math.random())/(t-1),j=(x+Math.random())/(e-1),k=g.getRay(S,j);R=c.add(R,C(k,l,i))}const F=((e-x)*t+z)*r;c.writeColor(R,F,s,a)}const f=document.getElementById("canvas");f.width=t,f.height=e;const y=f.getContext("2d");if(y===null)throw new Error("Failed to get context");const P=new Uint8ClampedArray(s),U=new ImageData(P,t,e);y.putImageData(U,0,0)};O();
